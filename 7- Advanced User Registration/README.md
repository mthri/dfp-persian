
<h1 dir="rtl"> 
فصل ۷: Advanced user registration
</h1>
<p dir="rtl">
در این مرحله ما کاربر استاندارد جنگو  را داریم اما اغلب اوقات این تنها نقطه شروع پروژه‌های حرفه‌ای می‌باشد نظرتان راجع به سفارشی کردن چیزها چیست؟ مثلا الگوی نام کاربری/ایمیل/رمز عبور پیش فرض جنگو تا حدودی قدمت دارد. برای ثبت نام و ورود به سیستم نیاز به ایمیل/رمزعبور بسیار متداول است در واقع هر قسمت از جریان و روند احراز هویت فرم‌ها ایمیل‌ها و صفحات در صورت تمایل قابلیت سفارشی سازی دارد.
</p>

<p dir="rtl">
 یکی دیگر از عوامل مهم در بسیاری از پروژه‌ها احراز هویت با شبکه‌های اجتماعی می‌باشد که از طریق یک سرویس ثالث مانند گوگل فیسبوک و ... انجام می‌گیرد.
 </p>
 <p dir="rtl">
 ما می‌توانیم برای انجام این کار (احراز هویت با شبکه‌های اجتماعی) آن را از ابتدا خودمان پیاده‌سازی کنیم اما خطرات قطعی وجود دارد: ثبت نام کاربر دارای یک محدوده‌ی پیچیده و اجزای متحرک بسیاری است و یک ناحیه‌ای است که ما واقعا نمی‌خواهیم باعث به وجود آمدن اشتباه امنیتی شویم.
 </p>
 <p dir="rtl">
 به این علت بسیاری از توسعه‌دهندگان جنگو به پکیج محبوب ثالث <a href="https://github.com/pennersr/django-allauth">django-allauth</a> تکیه می‌کنند اضافه کردن هر پکیج ثالث باید با کمی احتیاط همراه باشد چون شما در حال اضافه کردن وابستگی دیگری به دسته‌ی فنی خود هستید.  بسیار مهم باشد که مطمئن شوید هر پکیجی که از آن استفاده می‌کنید هم آپدیت باشد و هم به خوبی تست شده باشد. خوشبختانه پکیج django-allauth هر دوی این ویژگی‌ها را دارد. این پکیج با مقداری جادو تمام این نگرانی‌ها را برطرف می‌کند و سفارشی سازی بسیار آسان می‌شود.
 </p>
 <p dir="lrt">
 
 **django-allauth**
</p>
<p dir="rtl">
 با نصب پکیج شروع می‌کنیم به خاطر اینکه ما در حال استفاده از pipenv هستیم ما می‌خواهیم که از ناسازگاری‌ها با pipfile.lock دوری کنیم بنابراین ما در ابتدا آن را در داکر نصب خواهیم کرد سپس داکر را متوقف کرده و ایمیج فایل خود را با فلگ(پرچم) <span dir="ltr">--build</span> مجددا بیلد  می‌کنیم که مانع از ذخیره‌ی ایمیج فایل به صورت پیش فرض می‌شود و تضمین می‌کند که کل ایمیج فایل‌ها از صفر ساخته خواهد شد.
</p>


<p dir="lrt">

**Command line**
```bash
$ docker-compose exec web pipenv install django-allauth==0.42.0
$ docker-compose down
$ docker-compose up -d --build
```
</p>


<p dir="rtl">
وب سایت ما همچنان مانند قبل عمل می کند زیرا ما به طور واضح به جنگو در مورد این بسته جدید django-allauth نگفته ایم.
 برای انجام این کار ، ما باید پیکربندی INSTALLED_APPS را در تنظیمات خود به روز کنیم. 
اضافه کردن فریمورک 
<a href="https://docs.djangoproject.com/en/3.1/ref/contrib/sites/">sites</a>
همچنین allauth و ویژگی های اکانت allauth.account اختیاری می باشد.
<p>

<p dir="rtl">
فریمورک sites جنگو یک ویژگی قدرتمند هست که اجازه می دهد یک پروژه جنگو توسط چند سایت کنترل شود. با توجه به اینکه ما تنها یک سایت در پروژه خود داریم، SITE_ID  را ۱ تعیین خواهیم کرد. اگر سایت دومی را اضافه کنیم، دارای ID ۲ خواهد بود، سایت سوم دارای ID ۳، و به همین ترتیب خواهد بود.
</p>

<p dir="rtl">

**Code**
</p>

<p dir="ltr">

```python
# config/settings.py
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.sites', # new
    # Third-party
    'crispy_forms',
    'allauth', # new
    'allauth.account', # new
    # Local
    'accounts',
    'pages',
]
# django-allauth config
SITE_ID = 1 # new
```
</p>

